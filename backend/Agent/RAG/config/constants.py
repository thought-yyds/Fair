import os
import torch

# Cache and environment
MODEL_CACHE_DIR = "/home/grp/disk1/Huggface"
os.environ["TRANSFORMERS_CACHE"] = MODEL_CACHE_DIR
os.makedirs(MODEL_CACHE_DIR, exist_ok=True)

# Embeddings
EMBEDDING_MODEL = "all-MiniLM-L6-v2"
EMBEDDING_DEVICE = "cuda:2" if torch.cuda.is_available() else "cpu"

# BERT
BERT_MODEL_PATH = "/home/grp/disk1/Fair_detection/encapsulation/two_stage_model.pt"
BERT_TOKENIZER_PATH = "/home/grp/disk1/Agent/tokenizer"
BERT_CONFIDENCE_THRESHOLD = 0.05

# Rule mapping
RULE_MAPPING = {
    0: "不违规",
    1: "设置明显不必要或者超出实际需要的准入和退出条件，排斥或者限制经营者参与市场竞争",
    2: "没有法律、行政法规或者国务院规定依据，对不同所有制、地区、组织形式的经营者实施不合理的差别化待遇，设置不平等的市场准入和退出条件",
    3: "没有法律、行政法规或者国务院规定依据，以备案、登记、注册、目录、年检、年报、监制、认定、认证、认可、检验、监测、审定、指定、配号、复检、复审、换证、要求设立分支机构以及其他任何形式，设定或者变相设定市场准入障碍",
    4: "没有法律、行政法规或者国务院规定依据，对企业注销、破产、挂牌转让、搬迁转移等设定或者变相设定市场退出障碍",
    5: "以行政许可、行政检查、行政处罚、行政强制等方式，强制或者变相强制企业转让技术，设定或者变相设定市场准入和退出障碍",
    6: "在一般竞争性领域实施特许经营或者以特许经营为名增设行政许可",
    7: "未明确特许经营权期限或者未经法定程序延长特许经营权期限",
    8: "未依法采取招标、竞争性谈判等竞争方式，直接将特许经营权授予特定经营者",
    9: "设置歧视性条件，使经营者无法公平参与特许经营权竞争",
    10: "以明确要求、暗示、拒绝或者拖延行政审批、重复检查、不予接入平台或者网络、违法违规给予奖励补贴等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品和服务",
    11: "在招标投标、政府采购中限定投标人所在地、所有制形式、组织形式，或者设定其他不合理的条件排斥或者限制经营者参与招标投标、政府采购活动",
    12: "没有法律、行政法规或者国务院规定依据，通过设置不合理的项目库、名录库、备选库、资格库等条件，排斥或限制潜在经营者提供商品和服务",
    13: "没有法律、行政法规或者国务院规定依据，增设行政审批事项，增加行政审批环节、条件和程序",
    14: "没有法律、行政法规或者国务院规定依据，设置具有行政审批性质的前置性备案程序",
    15: "不得对市场准入负面清单以外的行业、领域、业务等设置审批程序，主要指没有法律、行政法规或者国务院规定依据，采取禁止进入、限制市场主体资质、限制股权比例、限制经营范围和商业模式等方式，限制或者变相限制市场准入",
    16: "制定政府定价或者政府指导价时，对外地和进口同类商品、服务制定歧视性价格",
    17: "对相关商品、服务进行补贴时，对外地同类商品、服务，国际经贸协定允许外的进口同类商品以及我国作出国际承诺的进口同类服务不予补贴或者给予较低补贴",
    18: "对外地商品、服务规定与本地同类商品、服务不同的技术要求、检验标准，或者采取重复检验、重复认证等歧视性技术措施",
    19: "对进口商品规定与本地同类商品不同的技术要求、检验标准，或者采取重复检验、重复认证等歧视性技术措施",
    20: "没有法律、行政法规或者国务院规定依据，对进口服务规定与本地同类服务不同的技术要求、检验标准，或者采取重复检验、重复认证等歧视性技术措施",
    21: "设置专门针对外地和进口商品、服务的专营、专卖、审批、许可、备案，或者规定不同的条件、程序和期限等",
    22: "在道路、车站、港口、航空港或者本行政区域边界设置关卡，阻碍外地和进口商品、服务进入本地市场或者本地商品运出和服务输出",
    23: "通过软件或者互联网设置屏蔽以及采取其他手段，阻碍外地和进口商品、服务进入本地市场或者本地商品运出和服务输出",
    24: "不依法及时、有效、完整地发布招标信息",
    25: "直接规定外地经营者不能参与本地特定的招标投标活动",
    26: "对外地经营者设定歧视性的资质资格要求或者评标评审标准",
    27: "将经营者在本地区的业绩、所获得的奖项荣誉作为投标条件、加分条件、中标条件或者用于评价企业信用等级，限制或者变相限制外地经营者参加本地招标投标活动",
    28: "没有法律、行政法规或者国务院规定依据，要求经营者在本地注册设立分支机构，在本地拥有一定办公面积，在本地缴纳社会保险等，限制或者变相限制外地经营者参加本地招标投标活动",
    29: "通过设定与招标项目的具体特点和实际需要不相适应或者与合同履行无关的资格、技术和商务条件，限制或者变相限制外地经营者参加本地招标投标活动",
    30: "直接拒绝外地经营者在本地投资或者设立分支机构",
    31: "没有法律、行政法规或者国务院规定依据，对外地经营者在本地投资的规模、方式以及设立分支机构的地址、模式等进行限制",
    32: "没有法律、行政法规或者国务院规定依据，直接强制外地经营者在本地投资或者设立分支机构",
    33: "没有法律、行政法规或者国务院规定依据，将在本地投资或者设立分支机构作为参与本地招标投标、享受补贴和优惠政策等的必要条件，变相强制外地经营者在本地投资或者设立分支机构",
    34: "对外地经营者在本地的投资不给予与本地经营者同等的政策待遇",
    35: "对外地经营者在本地设立的分支机构在经营规模、经营方式、税费缴纳等方面规定与本地经营者不同的要求",
    36: "在节能环保、安全生产、健康卫生、工程质量、市场监管等方面，对外地经营者在本地设立的分支机构规定歧视性监管标准和要求",
    37: "没有法律、行政法规或者国务院规定依据，给予特定经营者财政奖励和补贴",
    38: "没有专门的税收法律、法规和国务院规定依据，给予特定经营者税收优惠政策",
    39: "没有法律、行政法规或者国务院规定依据，在土地、劳动力、资本、技术、数据等要素获取方面，给予特定经营者优惠政策",
    40: "没有法律、行政法规或者国务院规定依据，在环保标准、排污权限等方面给予特定经营者特殊待遇",
    41: "没有法律、行政法规或者国务院规定依据，对特定经营者减免、缓征或停征行政事业性收费、政府性基金、住房公积金等",
    42: "安排财政支出一般不得与特定经营者缴纳的税收或非税收入挂钩，主要指根据特定经营者缴纳的税收或者非税收入情况，采取列收列支或者违法违规采取先征后返、即征即退等形式，对特定经营者进行返还，或者给予特定经营者财政奖励或补贴、减免土地等自然资源有偿使用收入等优惠政策",
    43: "不得违法违规减免或者缓征特定经营者应当缴纳的社会保险费用，主要指没有法律、行政法规或者国务院规定依据，根据经营者规模、所有制形式、组织形式、地区等因素，减免或者缓征特定经营者需要缴纳的基本养老保险费、基本医疗保险费、失业保险费、工伤保险费、生育保险费等",
    44: "没有法律、行政法规依据或者经国务院批准，要求经营者交纳各类保证金",
    45: "限定只能以现金形式交纳投标保证金或履约保证金",
    46: "在经营者履行相关程序或者完成相关事项后，不依法退还经营者交纳的保证金及银行同期存款利息",
    47: "不得强制经营者从事《中华人民共和国反垄断法》禁止的垄断行为，主要指以行政命令、行政授权、行政指导等方式或者通过行业协会商会，强制、组织或者引导经营者达成垄断协议、滥用市场支配地位，以及实施具有或者可能具有排除、限制竞争效果的经营者集中等行为",
    48: "不得违法披露或者违法要求经营者披露生产经营敏感信息，为经营者实施垄断行为提供便利条件。生产经营敏感信息是指除依据法律、行政法规或者国务院规定需要公开之外，生产经营者未主动公开，通过公开渠道无法采集的生产经营数据。主要包括：拟定价格、成本、营业收入、利润、生产数量、销售数量、生产销售计划、进出口数量、经销商信息、终端客户信息等",
    49: "对实行政府指导价的商品、服务进行政府定价",
    50: "对不属于本级政府定价目录范围内的商品、服务制定政府定价或者政府指导价",
    51: "违反《中华人民共和国价格法》等法律法规采取价格干预措施",
    52: "制定公布商品和服务的统一执行价、参考价",
    53: "规定商品和服务的最高或者最低限价",
    54: "干预影响商品和服务价格水平的手续费、折扣或者其他费用",
}

# Paths
input_path = "/home/grp/disk1/FCR-langchain/file"
persist_directory = "/home/grp/disk1/FCR-langchain/vectorstore"
STRUCTURED_CHUNKS_JSON_PATH = "/home/grp/disk1/Agent/new_policy.json"
VIOLATION_OUTPUT_DIR = "/home/grp/disk1/FCR-langchain/violation_results"

# Retrieval and threading
LONG_CHAPTER_WARN_THRESHOLD = 3000
CHAPTER_BM25_THRESHOLD = 0.7
RETRIEVAL_CANDIDATE_SIZE = 20
RETRIEVAL_FINAL_K = 5
MAX_THREAD_WORKERS = 2

# Mode
TEST_DEMO = True
